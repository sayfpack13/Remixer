<Window x:Class="Remixer.WPF.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:Remixer.WPF"
        xmlns:vm="clr-namespace:Remixer.WPF.ViewModels"
        mc:Ignorable="d"
        Title="Audio Remixer" 
        WindowState="Maximized"
        WindowStartupLocation="CenterScreen">
    <Window.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="Themes/ModernTheme.xaml"/>
            </ResourceDictionary.MergedDictionaries>
            <local:BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
            <local:StringToVisibilityConverter x:Key="StringToVisibilityConverter"/>
            <local:ProgressToVisibilityConverter x:Key="ProgressToVisibilityConverter"/>
            <local:InvertedBooleanConverter x:Key="InvertedBooleanConverter"/>
            <local:AllTrueToBooleanConverter x:Key="AllTrueToBooleanConverter"/>
            <local:StatusTextConverter x:Key="StatusTextConverter"/>
        </ResourceDictionary>
    </Window.Resources>
    <Window.Background>
        <StaticResource ResourceKey="BackgroundPrimary"/>
    </Window.Background>
    <Window.DataContext>
        <vm:MainViewModel x:Name="ViewModel"/>
    </Window.DataContext>
    <Grid Margin="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Modern Header -->
        <Border Grid.Row="0" Background="{StaticResource BackgroundElevated}" 
                Padding="20,16" Margin="0,0,0,16" CornerRadius="12">
            <Border.Effect>
                <DropShadowEffect BlurRadius="12" ShadowDepth="4" Opacity="0.15"/>
            </Border.Effect>
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <StackPanel>
                    <TextBlock Text="Audio Remixer" Style="{StaticResource Heading1}" Margin="0,0,0,4"/>
                    <TextBlock Text="{Binding CurrentFile}" Style="{StaticResource CaptionText}" 
                               Margin="0,0,0,2" TextTrimming="CharacterEllipsis"/>
                    <TextBlock Text="{Binding AudioFileInfo}" Style="{StaticResource CaptionText}" 
                               Foreground="{StaticResource TextTertiary}"
                               Visibility="{Binding AudioFileInfo, Converter={StaticResource StringToVisibilityConverter}}"
                               TextTrimming="CharacterEllipsis"/>
                </StackPanel>
                <StackPanel Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Right">
                    <Button Content="Load Audio" Command="{Binding LoadAudioCommand}" 
                            Style="{StaticResource PrimaryButton}" Margin="0,0,8,0"
                            IsEnabled="{Binding IsLoadingAudio, Converter={StaticResource InvertedBooleanConverter}}"/>
                    <Button Content="ðŸ’¬ AI Chat" Command="{Binding OpenAIChatCommand}" 
                            Style="{StaticResource SuccessButton}" Margin="0,0,8,0"
                            ToolTip="Chat with AI to customize your remix"/>
                    <Button Content="AI Remix" Command="{Binding AIRemixCommand}" 
                            Style="{StaticResource SecondaryButton}" Margin="0,0,8,0"
                            IsEnabled="{Binding IsProcessing, Converter={StaticResource InvertedBooleanConverter}}"
                            ToolTip="Quick AI remix (one-click)"/>
                    <Button Content="Settings" Command="{Binding OpenSettingsCommand}" 
                            Style="{StaticResource SecondaryButton}" Margin="0,0,8,0"
                            IsEnabled="{Binding IsProcessing, Converter={StaticResource InvertedBooleanConverter}}"/>
                    <Button Content="ðŸ“‹ Logs" Command="{Binding OpenLogFolderCommand}" 
                            Style="{StaticResource SecondaryButton}" Margin="0,0,8,0"
                            ToolTip="Open log folder"/>
                    <Button Content="Export" Command="{Binding ExportAudioCommand}" 
                            Style="{StaticResource SecondaryButton}"/>
                </StackPanel>
            </Grid>
        </Border>
        
        <!-- Audio Playback Controls -->
        <Border Grid.Row="1" Background="{StaticResource BackgroundSecondary}" 
                CornerRadius="8" Padding="16" Margin="0,0,0,16"
                Visibility="{Binding IsAudioLoaded, Converter={StaticResource BooleanToVisibilityConverter}}">
            <Border.Effect>
                <DropShadowEffect BlurRadius="12" ShadowDepth="4" Opacity="0.15"/>
            </Border.Effect>
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                
                <!-- Playback Controls -->
                <StackPanel Grid.Row="0" Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,0,0,12">
                    <Button Content="â–¶ Play" Command="{Binding PlayCommand}" 
                            Style="{StaticResource SuccessButton}" Width="100" Margin="0,0,8,0"/>
                    <Button Content="â¸ Pause" Command="{Binding PauseCommand}" 
                            Style="{StaticResource SecondaryButton}" Width="100" Margin="0,0,8,0"/>
                    <Button Content="â¹ Stop" Command="{Binding StopCommand}" 
                            Style="{StaticResource DangerButton}" Width="100"/>
                </StackPanel>
                
                <!-- Position Display -->
                <Grid Grid.Row="1" Margin="0,0,0,8">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <TextBlock Grid.Column="0" Text="{Binding CurrentPosition}" 
                               Style="{StaticResource CaptionText}" VerticalAlignment="Center"/>
                    <TextBlock Grid.Column="2" Text="{Binding TotalDuration}" 
                               Style="{StaticResource CaptionText}" VerticalAlignment="Center"/>
                </Grid>
                
                <!-- Playback Seek Bar Container with Overlay -->
                <Grid Grid.Row="2">
                    <!-- Playback Seek Bar -->
                    <Slider Value="{Binding PlaybackPosition}" Maximum="100"
                            Style="{StaticResource ModernSeekBar}"
                            PreviewMouseLeftButtonDown="SeekBar_PreviewMouseLeftButtonDown"
                            PreviewMouseMove="SeekBar_PreviewMouseMove"
                            PreviewMouseUp="SeekBar_PreviewMouseUp"
                            LostMouseCapture="SeekBar_LostMouseCapture"
                            PreviewKeyDown="SeekBar_PreviewKeyDown"
                            ToolTip="{Binding CurrentPosition, StringFormat='Current: {0}'}"
                            Focusable="True"
                            IsEnabled="{Binding IsApplyingEffects, Converter={StaticResource InvertedBooleanConverter}}"/>

                    <!-- Applying Effects Indicator - Overlay on top of slider -->
                    <Border Background="{StaticResource AccentPrimary}"
                            CornerRadius="10" Padding="12,8" 
                            VerticalAlignment="Center"
                            HorizontalAlignment="Stretch"
                            Visibility="{Binding IsApplyingEffects, Converter={StaticResource BooleanToVisibilityConverter}}"
                            Panel.ZIndex="10">
                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center" HorizontalAlignment="Center">
                            <TextBlock Text="âš¡ Applying Effects..." Style="{StaticResource BodyText}"
                                       Foreground="White" FontWeight="SemiBold"/>
                        </StackPanel>
                    </Border>
                </Grid>
            </Grid>
        </Border>

        <!-- Main Content -->
        <Grid Grid.Row="2">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="300"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- Left Panel - Presets -->
            <Border Grid.Column="0" Style="{StaticResource ModernBorder}" Margin="0,0,16,0">
                <StackPanel>
                    <TextBlock Text="Presets" Style="{StaticResource Heading2}" Margin="0,0,0,12"/>
                    <ListBox ItemsSource="{Binding Presets}" SelectedItem="{Binding SelectedPreset}" 
                             Style="{StaticResource ModernListBox}"
                             Height="220" Margin="0,0,0,12">
                        <ListBox.ItemContainerStyle>
                            <Style TargetType="ListBoxItem" BasedOn="{StaticResource ModernListBoxItem}"/>
                        </ListBox.ItemContainerStyle>
                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <StackPanel>
                                    <TextBlock Text="{Binding Name}" FontWeight="SemiBold" 
                                               Foreground="{StaticResource TextPrimary}" FontSize="13"/>
                                    <TextBlock Text="{Binding Category}" Style="{StaticResource CaptionText}" Margin="0,2,0,0"/>
                                    <TextBlock Text="{Binding Description}" Style="{StaticResource CaptionText}" 
                                               TextWrapping="Wrap" Margin="0,2,0,0"/>
                                </StackPanel>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>
                    <Button Content="Apply Preset" Command="{Binding ApplyPresetCommand}" 
                            Style="{StaticResource PrimaryButton}" Margin="0,0,0,8"/>
                    <Button Content="Save Current as Preset" Command="{Binding SavePresetCommand}" 
                            Style="{StaticResource SuccessButton}" Margin="0,0,0,8"/>
                    <Button Content="Delete Selected Preset" Command="{Binding DeletePresetCommand}" 
                            Style="{StaticResource DangerButton}"/>
                    
                    <!-- Loading Indicator -->
                    <Border Background="{StaticResource BackgroundTertiary}" 
                            CornerRadius="6" Padding="12" Margin="0,12,0,0"
                            Visibility="{Binding IsLoadingAudio, Converter={StaticResource BooleanToVisibilityConverter}}">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="â³" FontSize="16" Margin="0,0,8,0" VerticalAlignment="Center"/>
                            <TextBlock Text="Loading audio..." Style="{StaticResource BodyText}" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Border>
                    
                    <!-- Processing Indicator with Progress -->
                    <Border Background="{StaticResource AccentPrimary}" 
                            CornerRadius="6" Padding="12" Margin="0,12,0,0"
                            Visibility="{Binding IsProcessing, Converter={StaticResource BooleanToVisibilityConverter}}">
                        <StackPanel>
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                <TextBlock Text="â³" FontSize="16" Margin="0,0,8,0" VerticalAlignment="Center">
                                    <TextBlock.Style>
                                        <Style TargetType="TextBlock">
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding IsProcessing}" Value="True">
                                                    <DataTrigger.EnterActions>
                                                        <BeginStoryboard>
                                                            <Storyboard RepeatBehavior="Forever">
                                                                <DoubleAnimation Storyboard.TargetProperty="(TextBlock.RenderTransform).(RotateTransform.Angle)"
                                                                                 From="0" To="360" Duration="0:0:1"/>
                                                            </Storyboard>
                                                        </BeginStoryboard>
                                                    </DataTrigger.EnterActions>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </TextBlock.Style>
                                    <TextBlock.RenderTransform>
                                        <RotateTransform CenterX="8" CenterY="8"/>
                                    </TextBlock.RenderTransform>
                                </TextBlock>
                                <TextBlock Text="{Binding AIStatus}" Style="{StaticResource BodyText}" 
                                           Foreground="White" VerticalAlignment="Center" FontWeight="SemiBold"/>
                            </StackPanel>
                            <ProgressBar Value="{Binding Progress}" Maximum="100" Height="6" 
                                        Background="{StaticResource BackgroundTertiary}"
                                        Foreground="White" BorderThickness="0"
                                        Visibility="{Binding Progress, Converter={StaticResource ProgressToVisibilityConverter}}"/>
                        </StackPanel>
                    </Border>
                    
                    <!-- AI Status -->
                    <Separator Margin="0,20,0,12" Background="{StaticResource BorderColor}"/>
                    <TextBlock Text="AI Status" Style="{StaticResource Heading2}" Margin="0,0,0,8"/>
                    <Border Background="{StaticResource BackgroundTertiary}" 
                            CornerRadius="6" Padding="12" Margin="0,0,0,8">
                        <TextBlock Text="{Binding AIStatus}" Style="{StaticResource BodyText}" 
                                   TextWrapping="Wrap"/>
                    </Border>
                    <Border Background="{StaticResource BackgroundTertiary}" 
                            CornerRadius="6" Padding="12"
                            Visibility="{Binding AIReasoning, Converter={StaticResource StringToVisibilityConverter}}">
                        <TextBlock Text="{Binding AIReasoning}" Style="{StaticResource CaptionText}" 
                                   TextWrapping="Wrap"/>
                    </Border>
                </StackPanel>
            </Border>

            <!-- Right Panel - Audio Controls -->
            <ScrollViewer Grid.Column="1" Style="{StaticResource ModernScrollViewer}">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    
                    <!-- No Audio Loaded Message - spans both columns -->
                    <Border Grid.Row="0" Grid.Column="0" Grid.ColumnSpan="2"
                            Background="{StaticResource BackgroundSecondary}"
                            CornerRadius="6" Padding="16" Margin="0,0,0,16"
                            Visibility="{Binding ShouldShowLoadAudioFirst, Converter={StaticResource BooleanToVisibilityConverter}}">
                        <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                            <TextBlock Text="ðŸŽµ Load Audio First" Style="{StaticResource BodyText}"
                                       FontWeight="SemiBold" Foreground="{StaticResource TextSecondary}"
                                       HorizontalAlignment="Center" Margin="0,0,0,8"/>
                            <TextBlock Text="Click 'Load Audio' to start remixing your music!"
                                       Style="{StaticResource CaptionText}" Foreground="{StaticResource TextSecondary}"
                                       HorizontalAlignment="Center" TextWrapping="Wrap"/>
                        </StackPanel>
                    </Border>

                    <!-- Tempo & Pitch - spans both columns -->
                    <GroupBox Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="2" Header="Tempo &amp; Pitch" Style="{StaticResource ModernGroupBox}">
                        <GroupBox.Visibility>
                            <Binding Path="IsAudioLoaded" Converter="{StaticResource BooleanToVisibilityConverter}"/>
                        </GroupBox.Visibility>
                        <StackPanel>
                            <Grid Margin="0,0,0,16">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="100"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="60"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Text="Tempo" Grid.Column="0" VerticalAlignment="Center" 
                                           Style="{StaticResource BodyText}"/>
                                <Slider Grid.Column="1" Minimum="0.5" Maximum="2.0" 
                                        Value="{Binding Settings.Tempo, UpdateSourceTrigger=PropertyChanged}" 
                                        Style="{StaticResource ModernSlider}"
                                        TickFrequency="0.1" IsSnapToTickEnabled="True" Margin="16,0"/>
                                <TextBlock Text="{Binding Settings.Tempo, StringFormat='{}{0:F2}x'}" Grid.Column="2" 
                                           VerticalAlignment="Center" HorizontalAlignment="Right"
                                           Style="{StaticResource BodyText}"/>
                            </Grid>
                            <Grid Margin="0,0,0,16">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="100"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="60"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Text="Pitch" Grid.Column="0" VerticalAlignment="Center" 
                                           Style="{StaticResource BodyText}"/>
                                <Slider Grid.Column="1" Minimum="-12" Maximum="12" 
                                        Value="{Binding Settings.Pitch, UpdateSourceTrigger=PropertyChanged}" 
                                        Style="{StaticResource ModernSlider}"
                                        TickFrequency="1" IsSnapToTickEnabled="True" Margin="16,0"/>
                                <TextBlock Text="{Binding Settings.Pitch, StringFormat='{}{0:F0} st'}" Grid.Column="2" 
                                           VerticalAlignment="Center" HorizontalAlignment="Right"
                                           Style="{StaticResource BodyText}"/>
                            </Grid>
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="100"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="60"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Text="Volume" Grid.Column="0" VerticalAlignment="Center" 
                                           Style="{StaticResource BodyText}"/>
                                <Slider Grid.Column="1" Minimum="0" Maximum="2" 
                                        Value="{Binding Settings.Volume, UpdateSourceTrigger=PropertyChanged}" 
                                        Style="{StaticResource ModernSlider}"
                                        TickFrequency="0.1" IsSnapToTickEnabled="True" Margin="16,0"/>
                                <TextBlock Text="{Binding Settings.Volume, StringFormat='{}{0:F1}'}" Grid.Column="2" 
                                           VerticalAlignment="Center" HorizontalAlignment="Right"
                                           Style="{StaticResource BodyText}"/>
                            </Grid>
                        </StackPanel>
                    </GroupBox>

                    <!-- Reverb -->
                    <GroupBox Grid.Row="2" Grid.Column="0" Header="Reverb" Style="{StaticResource ModernGroupBox}" Margin="0,0,8,16">
                        <GroupBox.Visibility>
                            <Binding Path="IsAudioLoaded" Converter="{StaticResource BooleanToVisibilityConverter}"/>
                        </GroupBox.Visibility>
                        <StackPanel>
                            <CheckBox Content="Enable Reverb" IsChecked="{Binding Settings.Reverb.Enabled}" 
                                      Style="{StaticResource ModernCheckBox}"/>
                            <Grid IsEnabled="{Binding Settings.Reverb.Enabled}">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                <Grid Grid.Row="0" Margin="0,0,0,16">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="100"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="60"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Text="Room Size" Grid.Column="0" VerticalAlignment="Center" 
                                               Style="{StaticResource BodyText}"/>
                                    <Slider Grid.Column="1" Minimum="0" Maximum="1" 
                                            Value="{Binding Settings.Reverb.RoomSize, UpdateSourceTrigger=PropertyChanged}" 
                                            Style="{StaticResource ModernSlider}"
                                            TickFrequency="0.1" IsSnapToTickEnabled="True" Margin="16,0"/>
                                    <TextBlock Text="{Binding Settings.Reverb.RoomSize, StringFormat='{}{0:F2}'}" Grid.Column="2" 
                                               VerticalAlignment="Center" HorizontalAlignment="Right"
                                               Style="{StaticResource BodyText}"/>
                                </Grid>
                                <Grid Grid.Row="1" Margin="0,0,0,16">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="100"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="60"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Text="Damping" Grid.Column="0" VerticalAlignment="Center" 
                                               Style="{StaticResource BodyText}"/>
                                    <Slider Grid.Column="1" Minimum="0" Maximum="1" 
                                            Value="{Binding Settings.Reverb.Damping, UpdateSourceTrigger=PropertyChanged}" 
                                            Style="{StaticResource ModernSlider}"
                                            TickFrequency="0.1" IsSnapToTickEnabled="True" Margin="16,0"/>
                                    <TextBlock Text="{Binding Settings.Reverb.Damping, StringFormat='{}{0:F2}'}" Grid.Column="2" 
                                               VerticalAlignment="Center" HorizontalAlignment="Right"
                                               Style="{StaticResource BodyText}"/>
                                </Grid>
                                <Grid Grid.Row="2">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="100"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="60"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Text="Wet Level" Grid.Column="0" VerticalAlignment="Center" 
                                               Style="{StaticResource BodyText}"/>
                                    <Slider Grid.Column="1" Minimum="0" Maximum="1" 
                                            Value="{Binding Settings.Reverb.WetLevel, UpdateSourceTrigger=PropertyChanged}" 
                                            Style="{StaticResource ModernSlider}"
                                            TickFrequency="0.1" IsSnapToTickEnabled="True" Margin="16,0"/>
                                    <TextBlock Text="{Binding Settings.Reverb.WetLevel, StringFormat='{}{0:F2}'}" Grid.Column="2" 
                                               VerticalAlignment="Center" HorizontalAlignment="Right"
                                               Style="{StaticResource BodyText}"/>
                                </Grid>
                            </Grid>
                        </StackPanel>
                    </GroupBox>

                    <!-- Echo -->
                    <GroupBox Grid.Row="2" Grid.Column="1" Header="Echo / Delay" Style="{StaticResource ModernGroupBox}" Margin="8,0,0,16">
                        <GroupBox.Visibility>
                            <Binding Path="IsAudioLoaded" Converter="{StaticResource BooleanToVisibilityConverter}"/>
                        </GroupBox.Visibility>
                        <StackPanel>
                            <CheckBox Content="Enable Echo" IsChecked="{Binding Settings.Echo.Enabled}" 
                                      Style="{StaticResource ModernCheckBox}"/>
                            <Grid IsEnabled="{Binding Settings.Echo.Enabled}">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                <Grid Grid.Row="0" Margin="0,0,0,16">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="100"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="60"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Text="Delay" Grid.Column="0" VerticalAlignment="Center" 
                                               Style="{StaticResource BodyText}"/>
                                    <Slider Grid.Column="1" Minimum="0" Maximum="1" 
                                            Value="{Binding Settings.Echo.Delay, UpdateSourceTrigger=PropertyChanged}" 
                                            Style="{StaticResource ModernSlider}"
                                            TickFrequency="0.05" IsSnapToTickEnabled="True" Margin="16,0"/>
                                    <TextBlock Text="{Binding Settings.Echo.Delay, StringFormat='{}{0:F2}s'}" Grid.Column="2" 
                                               VerticalAlignment="Center" HorizontalAlignment="Right"
                                               Style="{StaticResource BodyText}"/>
                                </Grid>
                                <Grid Grid.Row="1" Margin="0,0,0,16">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="100"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="60"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Text="Feedback" Grid.Column="0" VerticalAlignment="Center" 
                                               Style="{StaticResource BodyText}"/>
                                    <Slider Grid.Column="1" Minimum="0" Maximum="1" 
                                            Value="{Binding Settings.Echo.Feedback, UpdateSourceTrigger=PropertyChanged}" 
                                            Style="{StaticResource ModernSlider}"
                                            TickFrequency="0.1" IsSnapToTickEnabled="True" Margin="16,0"/>
                                    <TextBlock Text="{Binding Settings.Echo.Feedback, StringFormat='{}{0:F2}'}" Grid.Column="2" 
                                               VerticalAlignment="Center" HorizontalAlignment="Right"
                                               Style="{StaticResource BodyText}"/>
                                </Grid>
                                <Grid Grid.Row="2">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="100"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="60"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Text="Wet Level" Grid.Column="0" VerticalAlignment="Center" 
                                               Style="{StaticResource BodyText}"/>
                                    <Slider Grid.Column="1" Minimum="0" Maximum="1" 
                                            Value="{Binding Settings.Echo.WetLevel, UpdateSourceTrigger=PropertyChanged}" 
                                            Style="{StaticResource ModernSlider}"
                                            TickFrequency="0.1" IsSnapToTickEnabled="True" Margin="16,0"/>
                                    <TextBlock Text="{Binding Settings.Echo.WetLevel, StringFormat='{}{0:F2}'}" Grid.Column="2" 
                                               VerticalAlignment="Center" HorizontalAlignment="Right"
                                               Style="{StaticResource BodyText}"/>
                                </Grid>
                            </Grid>
                        </StackPanel>
                    </GroupBox>

                    <!-- Filter / EQ -->
                    <GroupBox Grid.Row="3" Grid.Column="0" Grid.ColumnSpan="2" Header="Filter / EQ" Style="{StaticResource ModernGroupBox}">
                        <GroupBox.Visibility>
                            <Binding Path="IsAudioLoaded" Converter="{StaticResource BooleanToVisibilityConverter}"/>
                        </GroupBox.Visibility>
                        <StackPanel>
                            <CheckBox Content="Enable Filter" IsChecked="{Binding Settings.Filter.Enabled}" 
                                      Style="{StaticResource ModernCheckBox}"/>
                            <Grid IsEnabled="{Binding Settings.Filter.Enabled}">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                <Grid Grid.Row="0" Margin="0,0,0,16">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="100"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="60"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Text="Low Cut" Grid.Column="0" VerticalAlignment="Center" 
                                               Style="{StaticResource BodyText}"/>
                                    <Slider Grid.Column="1" Minimum="20" Maximum="500" 
                                            Value="{Binding Settings.Filter.LowCut, UpdateSourceTrigger=PropertyChanged}" 
                                            Style="{StaticResource ModernSlider}"
                                            TickFrequency="10" IsSnapToTickEnabled="True" Margin="16,0"/>
                                    <TextBlock Text="{Binding Settings.Filter.LowCut, StringFormat='{}{0:F0}Hz'}" Grid.Column="2" 
                                               VerticalAlignment="Center" HorizontalAlignment="Right"
                                               Style="{StaticResource BodyText}"/>
                                </Grid>
                                <Grid Grid.Row="1" Margin="0,0,0,16">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="100"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="60"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Text="High Cut" Grid.Column="0" VerticalAlignment="Center" 
                                               Style="{StaticResource BodyText}"/>
                                    <Slider Grid.Column="1" Minimum="5000" Maximum="20000" 
                                            Value="{Binding Settings.Filter.HighCut, UpdateSourceTrigger=PropertyChanged}" 
                                            Style="{StaticResource ModernSlider}"
                                            TickFrequency="500" IsSnapToTickEnabled="True" Margin="16,0"/>
                                    <TextBlock Text="{Binding Settings.Filter.HighCut, StringFormat='{}{0:F0}Hz'}" Grid.Column="2" 
                                               VerticalAlignment="Center" HorizontalAlignment="Right"
                                               Style="{StaticResource BodyText}"/>
                                </Grid>
                                <Grid Grid.Row="2" Margin="0,0,0,16">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="100"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="60"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Text="Low Gain" Grid.Column="0" VerticalAlignment="Center" 
                                               Style="{StaticResource BodyText}"/>
                                    <Slider Grid.Column="1" Minimum="-12" Maximum="12" 
                                            Value="{Binding Settings.Filter.LowGain, UpdateSourceTrigger=PropertyChanged}" 
                                            Style="{StaticResource ModernSlider}"
                                            TickFrequency="1" IsSnapToTickEnabled="True" Margin="16,0"/>
                                    <TextBlock Text="{Binding Settings.Filter.LowGain, StringFormat='{}{0:F0}dB'}" Grid.Column="2" 
                                               VerticalAlignment="Center" HorizontalAlignment="Right"
                                               Style="{StaticResource BodyText}"/>
                                </Grid>
                                <Grid Grid.Row="3" Margin="0,0,0,16">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="100"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="60"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Text="Mid Gain" Grid.Column="0" VerticalAlignment="Center" 
                                               Style="{StaticResource BodyText}"/>
                                    <Slider Grid.Column="1" Minimum="-12" Maximum="12" 
                                            Value="{Binding Settings.Filter.MidGain, UpdateSourceTrigger=PropertyChanged}" 
                                            Style="{StaticResource ModernSlider}"
                                            TickFrequency="1" IsSnapToTickEnabled="True" Margin="16,0"/>
                                    <TextBlock Text="{Binding Settings.Filter.MidGain, StringFormat='{}{0:F0}dB'}" Grid.Column="2" 
                                               VerticalAlignment="Center" HorizontalAlignment="Right"
                                               Style="{StaticResource BodyText}"/>
                                </Grid>
                                <Grid Grid.Row="4">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="100"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="60"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Text="High Gain" Grid.Column="0" VerticalAlignment="Center" 
                                               Style="{StaticResource BodyText}"/>
                                    <Slider Grid.Column="1" Minimum="-12" Maximum="12" 
                                            Value="{Binding Settings.Filter.HighGain, UpdateSourceTrigger=PropertyChanged}" 
                                            Style="{StaticResource ModernSlider}"
                                            TickFrequency="1" IsSnapToTickEnabled="True" Margin="16,0"/>
                                    <TextBlock Text="{Binding Settings.Filter.HighGain, StringFormat='{}{0:F0}dB'}" Grid.Column="2" 
                                               VerticalAlignment="Center" HorizontalAlignment="Right"
                                               Style="{StaticResource BodyText}"/>
                                </Grid>
                            </Grid>
                        </StackPanel>
                    </GroupBox>

                    <!-- Tremolo -->
                    <GroupBox Grid.Row="4" Grid.Column="0" Header="Tremolo" Style="{StaticResource ModernGroupBox}" Margin="0,0,8,16">
                        <GroupBox.Visibility>
                            <Binding Path="IsAudioLoaded" Converter="{StaticResource BooleanToVisibilityConverter}"/>
                        </GroupBox.Visibility>
                        <StackPanel>
                            <CheckBox Content="Enable Tremolo" IsChecked="{Binding Settings.Tremolo.Enabled}" 
                                      Style="{StaticResource ModernCheckBox}"/>
                            <Grid IsEnabled="{Binding Settings.Tremolo.Enabled}">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                <Grid Grid.Row="0" Margin="0,0,0,16">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="100"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="60"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Text="Rate" Grid.Column="0" VerticalAlignment="Center" 
                                               Style="{StaticResource BodyText}"/>
                                    <Slider Grid.Column="1" Minimum="0.1" Maximum="10" 
                                            Value="{Binding Settings.Tremolo.Rate, UpdateSourceTrigger=PropertyChanged}" 
                                            Style="{StaticResource ModernSlider}"
                                            TickFrequency="0.5" IsSnapToTickEnabled="True" Margin="16,0"/>
                                    <TextBlock Text="{Binding Settings.Tremolo.Rate, StringFormat='{}{0:F1}Hz'}" Grid.Column="2" 
                                               VerticalAlignment="Center" HorizontalAlignment="Right"
                                               Style="{StaticResource BodyText}"/>
                                </Grid>
                                <Grid Grid.Row="1">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="100"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="60"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Text="Depth" Grid.Column="0" VerticalAlignment="Center" 
                                               Style="{StaticResource BodyText}"/>
                                    <Slider Grid.Column="1" Minimum="0" Maximum="1" 
                                            Value="{Binding Settings.Tremolo.Depth, UpdateSourceTrigger=PropertyChanged}" 
                                            Style="{StaticResource ModernSlider}"
                                            TickFrequency="0.1" IsSnapToTickEnabled="True" Margin="16,0"/>
                                    <TextBlock Text="{Binding Settings.Tremolo.Depth, StringFormat='{}{0:F2}'}" Grid.Column="2" 
                                               VerticalAlignment="Center" HorizontalAlignment="Right"
                                               Style="{StaticResource BodyText}"/>
                                </Grid>
                            </Grid>
                        </StackPanel>
                    </GroupBox>

                    <!-- Compressor -->
                    <GroupBox Grid.Row="4" Grid.Column="1" Header="Compressor" Style="{StaticResource ModernGroupBox}" Margin="8,0,0,16">
                        <GroupBox.Visibility>
                            <Binding Path="IsAudioLoaded" Converter="{StaticResource BooleanToVisibilityConverter}"/>
                        </GroupBox.Visibility>
                        <StackPanel>
                            <CheckBox Content="Enable Compressor" IsChecked="{Binding Settings.Compressor.Enabled}" 
                                      Style="{StaticResource ModernCheckBox}"/>
                            <Grid IsEnabled="{Binding Settings.Compressor.Enabled}">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                <Grid Grid.Row="0" Margin="0,0,0,16">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="100"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="60"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Text="Threshold" Grid.Column="0" VerticalAlignment="Center" 
                                               Style="{StaticResource BodyText}"/>
                                    <Slider Grid.Column="1" Minimum="-60" Maximum="0" 
                                            Value="{Binding Settings.Compressor.Threshold, UpdateSourceTrigger=PropertyChanged}" 
                                            Style="{StaticResource ModernSlider}"
                                            TickFrequency="5" IsSnapToTickEnabled="True" Margin="16,0"/>
                                    <TextBlock Text="{Binding Settings.Compressor.Threshold, StringFormat='{}{0:F0}dB'}" Grid.Column="2" 
                                               VerticalAlignment="Center" HorizontalAlignment="Right"
                                               Style="{StaticResource BodyText}"/>
                                </Grid>
                                <Grid Grid.Row="1" Margin="0,0,0,16">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="100"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="60"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Text="Ratio" Grid.Column="0" VerticalAlignment="Center" 
                                               Style="{StaticResource BodyText}"/>
                                    <Slider Grid.Column="1" Minimum="1" Maximum="20" 
                                            Value="{Binding Settings.Compressor.Ratio, UpdateSourceTrigger=PropertyChanged}" 
                                            Style="{StaticResource ModernSlider}"
                                            TickFrequency="1" IsSnapToTickEnabled="True" Margin="16,0"/>
                                    <TextBlock Text="{Binding Settings.Compressor.Ratio, StringFormat='{}{0:F0}:1'}" Grid.Column="2" 
                                               VerticalAlignment="Center" HorizontalAlignment="Right"
                                               Style="{StaticResource BodyText}"/>
                                </Grid>
                                <Grid Grid.Row="2" Margin="0,0,0,16">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="100"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="60"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Text="Attack" Grid.Column="0" VerticalAlignment="Center" 
                                               Style="{StaticResource BodyText}"/>
                                    <Slider Grid.Column="1" Minimum="0.1" Maximum="100" 
                                            Value="{Binding Settings.Compressor.Attack, UpdateSourceTrigger=PropertyChanged}" 
                                            Style="{StaticResource ModernSlider}"
                                            TickFrequency="5" IsSnapToTickEnabled="True" Margin="16,0"/>
                                    <TextBlock Text="{Binding Settings.Compressor.Attack, StringFormat='{}{0:F1}ms'}" Grid.Column="2" 
                                               VerticalAlignment="Center" HorizontalAlignment="Right"
                                               Style="{StaticResource BodyText}"/>
                                </Grid>
                                <Grid Grid.Row="3" Margin="0,0,0,16">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="100"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="60"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Text="Release" Grid.Column="0" VerticalAlignment="Center" 
                                               Style="{StaticResource BodyText}"/>
                                    <Slider Grid.Column="1" Minimum="10" Maximum="1000" 
                                            Value="{Binding Settings.Compressor.Release, UpdateSourceTrigger=PropertyChanged}" 
                                            Style="{StaticResource ModernSlider}"
                                            TickFrequency="50" IsSnapToTickEnabled="True" Margin="16,0"/>
                                    <TextBlock Text="{Binding Settings.Compressor.Release, StringFormat='{}{0:F0}ms'}" Grid.Column="2" 
                                               VerticalAlignment="Center" HorizontalAlignment="Right"
                                               Style="{StaticResource BodyText}"/>
                                </Grid>
                                <Grid Grid.Row="4">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="100"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="60"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Text="Makeup Gain" Grid.Column="0" VerticalAlignment="Center" 
                                               Style="{StaticResource BodyText}"/>
                                    <Slider Grid.Column="1" Minimum="0" Maximum="12" 
                                            Value="{Binding Settings.Compressor.MakeupGain, UpdateSourceTrigger=PropertyChanged}" 
                                            Style="{StaticResource ModernSlider}"
                                            TickFrequency="1" IsSnapToTickEnabled="True" Margin="16,0"/>
                                    <TextBlock Text="{Binding Settings.Compressor.MakeupGain, StringFormat='{}{0:F0}dB'}" Grid.Column="2" 
                                               VerticalAlignment="Center" HorizontalAlignment="Right"
                                               Style="{StaticResource BodyText}"/>
                                </Grid>
                            </Grid>
                        </StackPanel>
                    </GroupBox>

                    <!-- Distortion -->
                    <GroupBox Grid.Row="5" Grid.Column="0" Header="Distortion" Style="{StaticResource ModernGroupBox}" Margin="0,0,8,16">
                        <GroupBox.Visibility>
                            <Binding Path="IsAudioLoaded" Converter="{StaticResource BooleanToVisibilityConverter}"/>
                        </GroupBox.Visibility>
                        <StackPanel>
                            <CheckBox Content="Enable Distortion" IsChecked="{Binding Settings.Distortion.Enabled}" 
                                      Style="{StaticResource ModernCheckBox}"/>
                            <Grid IsEnabled="{Binding Settings.Distortion.Enabled}">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                <Grid Grid.Row="0" Margin="0,0,0,16">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="100"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="60"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Text="Drive" Grid.Column="0" VerticalAlignment="Center" 
                                               Style="{StaticResource BodyText}"/>
                                    <Slider Grid.Column="1" Minimum="0" Maximum="1" 
                                            Value="{Binding Settings.Distortion.Drive, UpdateSourceTrigger=PropertyChanged}" 
                                            Style="{StaticResource ModernSlider}"
                                            TickFrequency="0.1" IsSnapToTickEnabled="True" Margin="16,0"/>
                                    <TextBlock Text="{Binding Settings.Distortion.Drive, StringFormat='{}{0:F2}'}" Grid.Column="2" 
                                               VerticalAlignment="Center" HorizontalAlignment="Right"
                                               Style="{StaticResource BodyText}"/>
                                </Grid>
                                <Grid Grid.Row="1" Margin="0,0,0,16">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="100"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="60"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Text="Tone" Grid.Column="0" VerticalAlignment="Center" 
                                               Style="{StaticResource BodyText}"/>
                                    <Slider Grid.Column="1" Minimum="0" Maximum="1" 
                                            Value="{Binding Settings.Distortion.Tone, UpdateSourceTrigger=PropertyChanged}" 
                                            Style="{StaticResource ModernSlider}"
                                            TickFrequency="0.1" IsSnapToTickEnabled="True" Margin="16,0"/>
                                    <TextBlock Text="{Binding Settings.Distortion.Tone, StringFormat='{}{0:F2}'}" Grid.Column="2" 
                                               VerticalAlignment="Center" HorizontalAlignment="Right"
                                               Style="{StaticResource BodyText}"/>
                                </Grid>
                                <Grid Grid.Row="2">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="100"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="60"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Text="Mix" Grid.Column="0" VerticalAlignment="Center" 
                                               Style="{StaticResource BodyText}"/>
                                    <Slider Grid.Column="1" Minimum="0" Maximum="1" 
                                            Value="{Binding Settings.Distortion.Mix, UpdateSourceTrigger=PropertyChanged}" 
                                            Style="{StaticResource ModernSlider}"
                                            TickFrequency="0.1" IsSnapToTickEnabled="True" Margin="16,0"/>
                                    <TextBlock Text="{Binding Settings.Distortion.Mix, StringFormat='{}{0:F2}'}" Grid.Column="2" 
                                               VerticalAlignment="Center" HorizontalAlignment="Right"
                                               Style="{StaticResource BodyText}"/>
                                </Grid>
                            </Grid>
                        </StackPanel>
                    </GroupBox>

                    <!-- Chorus -->
                    <GroupBox Grid.Row="5" Grid.Column="1" Header="Chorus" Style="{StaticResource ModernGroupBox}" Margin="8,0,0,16">
                        <GroupBox.Visibility>
                            <Binding Path="IsAudioLoaded" Converter="{StaticResource BooleanToVisibilityConverter}"/>
                        </GroupBox.Visibility>
                        <StackPanel>
                            <CheckBox Content="Enable Chorus" IsChecked="{Binding Settings.Chorus.Enabled}" 
                                      Style="{StaticResource ModernCheckBox}"/>
                            <Grid IsEnabled="{Binding Settings.Chorus.Enabled}">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                <Grid Grid.Row="0" Margin="0,0,0,16">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="100"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="60"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Text="Rate" Grid.Column="0" VerticalAlignment="Center" 
                                               Style="{StaticResource BodyText}"/>
                                    <Slider Grid.Column="1" Minimum="0.1" Maximum="5" 
                                            Value="{Binding Settings.Chorus.Rate, UpdateSourceTrigger=PropertyChanged}" 
                                            Style="{StaticResource ModernSlider}"
                                            TickFrequency="0.1" IsSnapToTickEnabled="True" Margin="16,0"/>
                                    <TextBlock Text="{Binding Settings.Chorus.Rate, StringFormat='{}{0:F1}Hz'}" Grid.Column="2" 
                                               VerticalAlignment="Center" HorizontalAlignment="Right"
                                               Style="{StaticResource BodyText}"/>
                                </Grid>
                                <Grid Grid.Row="1" Margin="0,0,0,16">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="100"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="60"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Text="Depth" Grid.Column="0" VerticalAlignment="Center" 
                                               Style="{StaticResource BodyText}"/>
                                    <Slider Grid.Column="1" Minimum="0" Maximum="1" 
                                            Value="{Binding Settings.Chorus.Depth, UpdateSourceTrigger=PropertyChanged}" 
                                            Style="{StaticResource ModernSlider}"
                                            TickFrequency="0.1" IsSnapToTickEnabled="True" Margin="16,0"/>
                                    <TextBlock Text="{Binding Settings.Chorus.Depth, StringFormat='{}{0:F2}'}" Grid.Column="2" 
                                               VerticalAlignment="Center" HorizontalAlignment="Right"
                                               Style="{StaticResource BodyText}"/>
                                </Grid>
                                <Grid Grid.Row="2">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="100"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="60"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Text="Mix" Grid.Column="0" VerticalAlignment="Center" 
                                               Style="{StaticResource BodyText}"/>
                                    <Slider Grid.Column="1" Minimum="0" Maximum="1" 
                                            Value="{Binding Settings.Chorus.Mix, UpdateSourceTrigger=PropertyChanged}" 
                                            Style="{StaticResource ModernSlider}"
                                            TickFrequency="0.1" IsSnapToTickEnabled="True" Margin="16,0"/>
                                    <TextBlock Text="{Binding Settings.Chorus.Mix, StringFormat='{}{0:F2}'}" Grid.Column="2" 
                                               VerticalAlignment="Center" HorizontalAlignment="Right"
                                               Style="{StaticResource BodyText}"/>
                                </Grid>
                            </Grid>
                        </StackPanel>
                    </GroupBox>

                    <!-- Flanger -->
                    <GroupBox Grid.Row="6" Grid.Column="0" Header="Flanger" Style="{StaticResource ModernGroupBox}" Margin="0,0,8,16">
                        <GroupBox.Visibility>
                            <Binding Path="IsAudioLoaded" Converter="{StaticResource BooleanToVisibilityConverter}"/>
                        </GroupBox.Visibility>
                        <StackPanel>
                            <CheckBox Content="Enable Flanger" IsChecked="{Binding Settings.Flanger.Enabled}" 
                                      Style="{StaticResource ModernCheckBox}"/>
                            <Grid IsEnabled="{Binding Settings.Flanger.Enabled}">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                <Grid Grid.Row="0" Margin="0,0,0,16">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="100"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="60"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Text="Delay" Grid.Column="0" VerticalAlignment="Center" 
                                               Style="{StaticResource BodyText}"/>
                                    <Slider Grid.Column="1" Minimum="0.001" Maximum="0.02" 
                                            Value="{Binding Settings.Flanger.Delay, UpdateSourceTrigger=PropertyChanged}" 
                                            Style="{StaticResource ModernSlider}"
                                            TickFrequency="0.001" IsSnapToTickEnabled="True" Margin="16,0"/>
                                    <TextBlock Text="{Binding Settings.Flanger.Delay, StringFormat='{}{0:F3}s'}" Grid.Column="2" 
                                               VerticalAlignment="Center" HorizontalAlignment="Right"
                                               Style="{StaticResource BodyText}"/>
                                </Grid>
                                <Grid Grid.Row="1" Margin="0,0,0,16">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="100"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="60"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Text="Rate" Grid.Column="0" VerticalAlignment="Center" 
                                               Style="{StaticResource BodyText}"/>
                                    <Slider Grid.Column="1" Minimum="0.1" Maximum="5" 
                                            Value="{Binding Settings.Flanger.Rate, UpdateSourceTrigger=PropertyChanged}" 
                                            Style="{StaticResource ModernSlider}"
                                            TickFrequency="0.1" IsSnapToTickEnabled="True" Margin="16,0"/>
                                    <TextBlock Text="{Binding Settings.Flanger.Rate, StringFormat='{}{0:F1}Hz'}" Grid.Column="2" 
                                               VerticalAlignment="Center" HorizontalAlignment="Right"
                                               Style="{StaticResource BodyText}"/>
                                </Grid>
                                <Grid Grid.Row="2" Margin="0,0,0,16">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="100"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="60"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Text="Depth" Grid.Column="0" VerticalAlignment="Center" 
                                               Style="{StaticResource BodyText}"/>
                                    <Slider Grid.Column="1" Minimum="0" Maximum="1" 
                                            Value="{Binding Settings.Flanger.Depth, UpdateSourceTrigger=PropertyChanged}" 
                                            Style="{StaticResource ModernSlider}"
                                            TickFrequency="0.1" IsSnapToTickEnabled="True" Margin="16,0"/>
                                    <TextBlock Text="{Binding Settings.Flanger.Depth, StringFormat='{}{0:F2}'}" Grid.Column="2" 
                                               VerticalAlignment="Center" HorizontalAlignment="Right"
                                               Style="{StaticResource BodyText}"/>
                                </Grid>
                                <Grid Grid.Row="3" Margin="0,0,0,16">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="100"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="60"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Text="Feedback" Grid.Column="0" VerticalAlignment="Center" 
                                               Style="{StaticResource BodyText}"/>
                                    <Slider Grid.Column="1" Minimum="-1" Maximum="1" 
                                            Value="{Binding Settings.Flanger.Feedback, UpdateSourceTrigger=PropertyChanged}" 
                                            Style="{StaticResource ModernSlider}"
                                            TickFrequency="0.1" IsSnapToTickEnabled="True" Margin="16,0"/>
                                    <TextBlock Text="{Binding Settings.Flanger.Feedback, StringFormat='{}{0:F2}'}" Grid.Column="2" 
                                               VerticalAlignment="Center" HorizontalAlignment="Right"
                                               Style="{StaticResource BodyText}"/>
                                </Grid>
                                <Grid Grid.Row="4">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="100"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="60"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Text="Mix" Grid.Column="0" VerticalAlignment="Center" 
                                               Style="{StaticResource BodyText}"/>
                                    <Slider Grid.Column="1" Minimum="0" Maximum="1" 
                                            Value="{Binding Settings.Flanger.Mix, UpdateSourceTrigger=PropertyChanged}" 
                                            Style="{StaticResource ModernSlider}"
                                            TickFrequency="0.1" IsSnapToTickEnabled="True" Margin="16,0"/>
                                    <TextBlock Text="{Binding Settings.Flanger.Mix, StringFormat='{}{0:F2}'}" Grid.Column="2" 
                                               VerticalAlignment="Center" HorizontalAlignment="Right"
                                               Style="{StaticResource BodyText}"/>
                                </Grid>
                            </Grid>
                        </StackPanel>
                    </GroupBox>

                    <!-- Phaser -->
                    <GroupBox Grid.Row="6" Grid.Column="1" Header="Phaser" Style="{StaticResource ModernGroupBox}" Margin="8,0,0,16">
                        <GroupBox.Visibility>
                            <Binding Path="IsAudioLoaded" Converter="{StaticResource BooleanToVisibilityConverter}"/>
                        </GroupBox.Visibility>
                        <StackPanel>
                            <CheckBox Content="Enable Phaser" IsChecked="{Binding Settings.Phaser.Enabled}" 
                                      Style="{StaticResource ModernCheckBox}"/>
                            <Grid IsEnabled="{Binding Settings.Phaser.Enabled}">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                <Grid Grid.Row="0" Margin="0,0,0,16">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="100"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="60"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Text="Rate" Grid.Column="0" VerticalAlignment="Center" 
                                               Style="{StaticResource BodyText}"/>
                                    <Slider Grid.Column="1" Minimum="0.1" Maximum="5" 
                                            Value="{Binding Settings.Phaser.Rate, UpdateSourceTrigger=PropertyChanged}" 
                                            Style="{StaticResource ModernSlider}"
                                            TickFrequency="0.1" IsSnapToTickEnabled="True" Margin="16,0"/>
                                    <TextBlock Text="{Binding Settings.Phaser.Rate, StringFormat='{}{0:F1}Hz'}" Grid.Column="2" 
                                               VerticalAlignment="Center" HorizontalAlignment="Right"
                                               Style="{StaticResource BodyText}"/>
                                </Grid>
                                <Grid Grid.Row="1" Margin="0,0,0,16">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="100"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="60"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Text="Depth" Grid.Column="0" VerticalAlignment="Center" 
                                               Style="{StaticResource BodyText}"/>
                                    <Slider Grid.Column="1" Minimum="0" Maximum="1" 
                                            Value="{Binding Settings.Phaser.Depth, UpdateSourceTrigger=PropertyChanged}" 
                                            Style="{StaticResource ModernSlider}"
                                            TickFrequency="0.1" IsSnapToTickEnabled="True" Margin="16,0"/>
                                    <TextBlock Text="{Binding Settings.Phaser.Depth, StringFormat='{}{0:F2}'}" Grid.Column="2" 
                                               VerticalAlignment="Center" HorizontalAlignment="Right"
                                               Style="{StaticResource BodyText}"/>
                                </Grid>
                                <Grid Grid.Row="2" Margin="0,0,0,16">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="100"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="60"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Text="Feedback" Grid.Column="0" VerticalAlignment="Center" 
                                               Style="{StaticResource BodyText}"/>
                                    <Slider Grid.Column="1" Minimum="-1" Maximum="1" 
                                            Value="{Binding Settings.Phaser.Feedback, UpdateSourceTrigger=PropertyChanged}" 
                                            Style="{StaticResource ModernSlider}"
                                            TickFrequency="0.1" IsSnapToTickEnabled="True" Margin="16,0"/>
                                    <TextBlock Text="{Binding Settings.Phaser.Feedback, StringFormat='{}{0:F2}'}" Grid.Column="2" 
                                               VerticalAlignment="Center" HorizontalAlignment="Right"
                                               Style="{StaticResource BodyText}"/>
                                </Grid>
                                <Grid Grid.Row="3">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="100"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="60"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Text="Mix" Grid.Column="0" VerticalAlignment="Center" 
                                               Style="{StaticResource BodyText}"/>
                                    <Slider Grid.Column="1" Minimum="0" Maximum="1" 
                                            Value="{Binding Settings.Phaser.Mix, UpdateSourceTrigger=PropertyChanged}" 
                                            Style="{StaticResource ModernSlider}"
                                            TickFrequency="0.1" IsSnapToTickEnabled="True" Margin="16,0"/>
                                    <TextBlock Text="{Binding Settings.Phaser.Mix, StringFormat='{}{0:F2}'}" Grid.Column="2" 
                                               VerticalAlignment="Center" HorizontalAlignment="Right"
                                               Style="{StaticResource BodyText}"/>
                                </Grid>
                            </Grid>
                        </StackPanel>
                    </GroupBox>

                    <!-- AI Indicator - spans both columns -->
                    <Border Grid.Row="7" Grid.Column="0" Grid.ColumnSpan="2" Background="{StaticResource AccentPrimary}" Padding="16" Margin="0,0,0,0" CornerRadius="8"
                            Visibility="{Binding IsAISet, Converter={StaticResource BooleanToVisibilityConverter}}">
                        <Border.Effect>
                            <DropShadowEffect BlurRadius="8" ShadowDepth="2" Opacity="0.2"/>
                        </Border.Effect>
                        <StackPanel>
                            <TextBlock Text="âœ¨ AI Parameters Applied" FontWeight="SemiBold" 
                                       Foreground="White" FontSize="14" Margin="0,0,0,6"/>
                            <TextBlock Text="These settings were automatically applied by AI. You can override them manually." 
                                       Style="{StaticResource CaptionText}" Foreground="#E0E0E0"/>
                        </StackPanel>
                    </Border>
                </Grid>
            </ScrollViewer>
        </Grid>

        <!-- Modern Footer -->
        <Border Grid.Row="3" Background="{StaticResource BackgroundElevated}" 
                Padding="16,12" Margin="0,16,0,0" CornerRadius="8">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="240"/>
                </Grid.ColumnDefinitions>
                <TextBlock Style="{StaticResource CaptionText}"
                           VerticalAlignment="Center">
                    <TextBlock.Text>
                        <MultiBinding Converter="{StaticResource StatusTextConverter}">
                            <Binding Path="IsAudioLoaded"/>
                            <Binding Path="IsProcessing"/>
                            <Binding Path="IsLoadingAudio"/>
                            <Binding Path="IsApplyingEffects"/>
                        </MultiBinding>
                    </TextBlock.Text>
                </TextBlock>
                <Border Grid.Column="1" Background="{StaticResource BackgroundTertiary}" 
                        CornerRadius="3" Height="6" 
                        Visibility="{Binding Progress, Converter={StaticResource ProgressToVisibilityConverter}}">
                    <ProgressBar Value="{Binding Progress}" Maximum="100" 
                                 Height="6" Background="Transparent"
                                 Foreground="{StaticResource AccentPrimary}"/>
                </Border>
            </Grid>
        </Border>
    </Grid>
</Window>
