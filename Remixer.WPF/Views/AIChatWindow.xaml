<Window x:Class="Remixer.WPF.Views.AIChatWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="clr-namespace:Remixer.WPF.ViewModels"
        xmlns:local="clr-namespace:Remixer.WPF"
        Title="AI Remix Assistant" Height="600" Width="800"
        WindowStartupLocation="CenterOwner"
        ResizeMode="CanResize"
        MinWidth="600" MinHeight="400">
    <Window.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="/Themes/ModernTheme.xaml"/>
            </ResourceDictionary.MergedDictionaries>
            <local:MessageRoleToBackgroundConverter x:Key="MessageRoleToBackgroundConverter"/>
            <local:MessageRoleToAlignmentConverter x:Key="MessageRoleToAlignmentConverter"/>
            <local:MessageRoleToLabelConverter x:Key="MessageRoleToLabelConverter"/>
            <local:MessageRoleToVisibilityConverter x:Key="MessageRoleToVisibilityConverter"/>
            <local:BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
            <local:InvertedBooleanToVisibilityConverter x:Key="InvertedBooleanToVisibilityConverter"/>
            <local:InvertedBooleanConverter x:Key="InvertedBooleanConverter"/>
        </ResourceDictionary>
    </Window.Resources>
    <Window.Background>
        <StaticResource ResourceKey="BackgroundPrimary"/>
    </Window.Background>
    
    <Grid Margin="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <Border Grid.Row="0" Background="{StaticResource BackgroundElevated}" 
                CornerRadius="8" Padding="16" Margin="0,0,0,12">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <StackPanel>
                    <TextBlock Text="AI Remix Assistant" Style="{StaticResource Heading1}" Margin="0,0,0,4"/>
                    <TextBlock Text="Chat with AI to customize your audio remix" 
                               Style="{StaticResource CaptionText}" 
                               Foreground="{StaticResource TextTertiary}"/>
                </StackPanel>
                <Button Grid.Column="1" Content="Clear Chat" Command="{Binding ClearChatCommand}"
                        Style="{StaticResource SecondaryButton}" Width="100"/>
            </Grid>
        </Border>

        <!-- Chat Messages -->
        <Border Grid.Row="1" Background="{StaticResource BackgroundSecondary}"
                CornerRadius="8" Padding="12">
            <ScrollViewer VerticalScrollBarVisibility="Auto" 
                          x:Name="MessagesScrollViewer">
                <ItemsControl ItemsSource="{Binding Messages}">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <Grid Margin="0,0,0,12">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto" MinWidth="200" MaxWidth="500"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <Border Grid.Column="1"
                                        Background="{Binding Role, Converter={StaticResource MessageRoleToBackgroundConverter}}"
                                        CornerRadius="8" Padding="12"
                                        HorizontalAlignment="{Binding Role, Converter={StaticResource MessageRoleToAlignmentConverter}}">
                                    <StackPanel>
                                    <TextBlock Text="{Binding Role, Converter={StaticResource MessageRoleToLabelConverter}}" 
                                               Style="{StaticResource CaptionText}"
                                               Foreground="{StaticResource TextTertiary}"
                                               Margin="0,0,0,4"
                                               Visibility="{Binding Role, Converter={StaticResource MessageRoleToVisibilityConverter}}"/>
                                    <TextBlock Text="{Binding Content}" 
                                               Style="{StaticResource BodyText}"
                                               TextWrapping="Wrap"/>
                                    <TextBlock Text="{Binding Timestamp, StringFormat='{}{0:HH:mm}'}" 
                                               Style="{StaticResource CaptionText}"
                                               Foreground="{StaticResource TextTertiary}"
                                               Margin="0,4,0,0"
                                               HorizontalAlignment="Right"
                                               FontSize="10"/>
                                    </StackPanel>
                                </Border>
                            </Grid>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </ScrollViewer>
        </Border>

        <!-- Typing Indicator -->
        <Border Grid.Row="2" Background="{StaticResource BackgroundTertiary}" 
                CornerRadius="8" Padding="12" Margin="0,12,0,0"
                Visibility="{Binding IsSending, Converter={StaticResource BooleanToVisibilityConverter}}">
            <StackPanel Orientation="Horizontal">
                <TextBlock Text="â³" FontSize="16" Margin="0,0,8,0" VerticalAlignment="Center">
                    <TextBlock.Style>
                        <Style TargetType="TextBlock">
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding IsSending}" Value="True">
                                    <DataTrigger.EnterActions>
                                        <BeginStoryboard>
                                            <Storyboard RepeatBehavior="Forever">
                                                <DoubleAnimation Storyboard.TargetProperty="(TextBlock.RenderTransform).(RotateTransform.Angle)"
                                                                 From="0" To="360" Duration="0:0:1"/>
                                            </Storyboard>
                                        </BeginStoryboard>
                                    </DataTrigger.EnterActions>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </TextBlock.Style>
                    <TextBlock.RenderTransform>
                        <RotateTransform CenterX="8" CenterY="8"/>
                    </TextBlock.RenderTransform>
                </TextBlock>
                <TextBlock Text="AI is thinking..." Style="{StaticResource BodyText}" 
                           Foreground="{StaticResource TextSecondary}"/>
            </StackPanel>
        </Border>

        <!-- Input Area -->
        <Grid Grid.Row="3" Margin="0,12,0,0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            <Border Grid.Column="0" Background="{StaticResource BackgroundSecondary}"
                    BorderBrush="{StaticResource BorderColor}"
                    BorderThickness="1"
                    CornerRadius="6">
                <TextBox Text="{Binding UserInput, UpdateSourceTrigger=PropertyChanged}"
                         FontSize="14" Padding="12,10"
                         Background="Transparent"
                         Foreground="{StaticResource TextPrimary}"
                         BorderThickness="0"
                         AcceptsReturn="True"
                         TextWrapping="Wrap"
                         VerticalContentAlignment="Center"
                         MinHeight="40"
                         MaxHeight="100"
                         KeyDown="TextBox_KeyDown"/>
            </Border>
            <Button Grid.Column="1" Content="Send" Command="{Binding SendMessageCommand}"
                    Style="{StaticResource PrimaryButton}" 
                    Margin="8,0,0,0" Width="80" Height="40"
                    IsEnabled="{Binding IsSending, Converter={StaticResource InvertedBooleanConverter}}"/>
        </Grid>

        <!-- Status Message -->
        <TextBlock Grid.Row="4" Text="Please load an audio file to start chatting" 
                   Style="{StaticResource CaptionText}"
                   Foreground="{StaticResource TextTertiary}"
                   HorizontalAlignment="Center"
                   Margin="0,8,0,0"
                   Visibility="{Binding IsAudioLoaded, Converter={StaticResource InvertedBooleanToVisibilityConverter}}"/>
    </Grid>
</Window>

